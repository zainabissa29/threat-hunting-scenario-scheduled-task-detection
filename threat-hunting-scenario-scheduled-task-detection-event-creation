# Threat Event: Scheduled Task & File Transfer

## Overview

**Scenario:** Scheduled Task Creation and Outbound File Transfer

This scenario simulates routine user/admin actions that generate valuable logs for blue team detection and SIEM validation, without being blocked by EDR tools.

---

## Steps the "Bad Actor" took to Create Logs and IoCs

**1. Created a scheduled task that launches Notepad after a short delay.**  
**Command:
$action = New-ScheduledTaskAction -Execute "notepad.exe"
$trigger = New-ScheduledTaskTrigger -Once -At (Get-Date).AddMinutes(2)
Register-ScheduledTask -TaskName "TestLogTask" -Action $action -Trigger $trigger

2. Copied the Notepad executable to the userâ€™s Temp directory.
Command:
Copy-Item "C:\Windows\System32\notepad.exe" "$env:TEMP\notepad_copy.exe"

3. Established an outbound HTTP connection by downloading a file from the internet.
Command:
Invoke-WebRequest -Uri "http://example.com" -OutFile "$env:TEMP\test-download.html"

4. Cleaned up by deleting the scheduled task and copied files.
Command:
Unregister-ScheduledTask -TaskName "TestLogTask" -Confirm:$false
Remove-Item "$env:TEMP\notepad_copy.exe" -Force
Remove-Item "$env:TEMP\test-download.html" -Force

Tables Used to Detect IoCs
Parameter	Description
Name	DeviceEvents
Info	DeviceEvents Table
Purpose	Detects scheduled task creation (ActionType: ScheduledTaskCreated)
Name	DeviceFileEvents
Info	DeviceFileEvents Table
Purpose	Detects file copy and creation activity in Temp or user directories
Name	DeviceNetworkEvents
Info	DeviceNetworkEvents Table
Purpose	Detects outbound HTTP/HTTPS connections from user activity

Related Queries 
Copy code
// Detect scheduled task creation
DeviceEvents
| where ActionType == "ScheduledTaskCreated"
| project Timestamp, DeviceName, InitiatingProcessAccountName, AdditionalFields
| order by Timestamp desc

// Detect file copy to TEMP directory
DeviceFileEvents
| where FolderPath contains "\\Temp\\"
| project Timestamp, DeviceName, FileName, FolderPath, InitiatingProcessAccountName
| order by Timestamp desc

// Detect outbound HTTP download activity
DeviceNetworkEvents
| where RemoteUrl has "example.com"
| project Timestamp, DeviceName, InitiatingProcessAccountName, RemoteUrl, RemotePort
| order by Timestamp desc
Attribution
Created By:

Author Name: Zainab Issa

Author Contact: Zainab Issa on LinkedIn

Date: September 21, 2025

Validated By:

Reviewer Name:

Reviewer Contact:

Validation Date:


Revision History
Version	Changes	Date	Modified By
1.0	Initial draft	September 21, 2025	Zainab Issa
